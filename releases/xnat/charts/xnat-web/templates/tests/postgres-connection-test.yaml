---
# https://www.postgresql.org/docs/current/libpq-envars.html
#
apiVersion: v1
kind: Pod
metadata:
  name: {{ template "xnat-web.postgresql.fullname" . }}-test-connection
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
  - image: postgres
    env:
      - name: PGHOST
        value: {{ template "xnat.postgresql.fullname" . }}
      - name: PGPASSWORD
        {{- include "xnat.postgresql.PGPASSWORD" . |nindent 8 }}
      - name: PGUSER
        value: {{ template "xnat.postgresql.username" . }}
      - name: PGDATABASE
        value: {{ template "xnat.postgresql.database" . }}
    command: ["/bin/sh"]
    args:
      - "-c"
      - |
        /usr/bin/pg_isready
    imagePullPolicy: IfNotPresent
    name: pg-isready
  restartPolicy: Never
