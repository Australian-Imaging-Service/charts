apiVersion: v1
kind: Pod
metadata:
  name: {{ template "xnat-web.postgresql.fullname" . }}-test-connection
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
    - name: postgres
      image: postgres
      command: [bash, -c]
      args:
        - |
          pg_isready
      env:
        - name: PGDATABASE
          {{- (include "xnat-web.postgresql.database" .) | nindent 10 }}
        - name: PGHOST
          {{- (include "xnat-web.postgresql.host" .) | nindent 10 }}
        - name: PGPASSWORD
          {{- (include "xnat-web.postgresql.password" .) | nindent 10 }}
        - name: PGPORT
          {{- (include "xnat-web.postgresql.port" .) | nindent 10 }}
        - name: PGUSER
          {{- (include "xnat-web.postgresql.user" .) | nindent 10 }}
      imagePullPolicy: IfNotPresent
  restartPolicy: Never
